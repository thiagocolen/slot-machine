const e=Object.freeze({SLOT_MACHINE_SIZE:3,REEL_SIZE:60,REEL_OFFSET:3,ANIMATION_DELAY:1e3,ANIMATION_DURATION:2e3,SYMBOL_QTY:2,SPIN_BUTTON_DELAY:800}),t=new(window.AudioContext||window.webkitAudioContext);class i{constructor(e){this.audioCtx=e,this.gainNode=this.audioCtx.createGain(),this.gainNode.connect(e.destination),this.gainNode.gain.value=.125,this.trackList=this.loadTracks()}loadTracks(){let e=document.querySelectorAll("audio"),t=[];return e.forEach(e=>{let i=document.querySelector(`#${e.id}`),n=this.audioCtx.createMediaElementSource(i);n.connect(this.gainNode),t.push({name:e.id,htmlMediaElement:i,mediaElementAudioSourceNode:n})}),t}async playTrack(e){this.trackList.forEach(t=>{t.name===e&&t.htmlMediaElement.play()})}}new class{constructor(){this.reel_animations=[],this.previous_reel=[],this.finished_reels=0,this.result=[],this.audioMachine=new i(t),this.initPreviousReelObj(),this.createSlotMachine(e.SLOT_MACHINE_SIZE),this.createSpinButton()}initPreviousReelObj(){for(let t=0;t<e.SLOT_MACHINE_SIZE;t++)this.previous_reel.push({slotNumber:t,symbolList:[]})}createSpinButton(){this.spinButton=document.getElementsByClassName("spin-button")[0],this.spinButton.addEventListener("click",()=>{this.spinButton.setAttribute("class","spin-button spin-button-clicked"),setTimeout(()=>{this.spinButton.setAttribute("class","spin-button")},e.SPIN_BUTTON_DELAY),this.spin()})}createSlotMachine(e){this.container=document.getElementsByClassName("slot-machine")[0],this.container.innerHTML="",this.reel_animations=[];for(let t=0;t<e;t++)this.reel_animations.push(this.createReel(t))}createReel(t){let i=document.createElement("div");i.setAttribute("class","reel"),i.setAttribute("id",`slot_${t}`);for(let t=0;t<=e.REEL_SIZE;t++){let t=Math.floor(Math.random()*e.SYMBOL_QTY),n=`<div class="symbol symbol_${t}" id="${t}"></div>`;i.innerHTML=i.innerHTML+n}return this.previousReelChange(t,i),this.container.appendChild(i),this.createReelAnimation(i)}previousReelChange(t,i){this.previous_reel.forEach(n=>{n.slotNumber===t&&(0===n.symbolList.length?i.prepend(i.children.item(i.children.length-e.REEL_OFFSET-1).cloneNode(!0),i.children.item(i.children.length-e.REEL_OFFSET).cloneNode(!0),i.children.item(i.children.length-e.REEL_OFFSET+1).cloneNode(!0)):i.prepend(...n.symbolList),n.symbolList=[],n.symbolList.push(i.children.item(i.children.length-e.REEL_OFFSET-1),i.children.item(i.children.length-e.REEL_OFFSET),i.children.item(i.children.length-e.REEL_OFFSET+1)))})}createReelAnimation(t){let i=document.getElementsByClassName("symbol")[0].clientHeight,n=[{transform:"translateY(0)"},{transform:`translateY(-${t.clientHeight-4*i}px)`}],s={delay:Math.floor(Math.random()*e.ANIMATION_DELAY),duration:e.ANIMATION_DURATION,easing:"cubic-bezier(.52,.08,.45,1.19)",iterations:1,direction:"normal",fill:"forwards"},o=t.animate(n,s);return o.cancel(),o.onfinish=()=>{this.finished_reels=this.finished_reels+1,this.finished_reels===e.SLOT_MACHINE_SIZE&&(this.getResult(),this.finished_reels=0)},o}spin(){this.createSlotMachine(e.SLOT_MACHINE_SIZE),setTimeout(()=>{this.audioMachine.playTrack("audio_wheel")},e.SPIN_BUTTON_DELAY),this.reel_animations.forEach(e=>{e.play()})}getResult(){this.result=[];for(let t=0;t<e.SLOT_MACHINE_SIZE;t++){let i=document.getElementById(`slot_${t}`).children.length-e.REEL_OFFSET;this.result.push(document.getElementById(`slot_${t}`).children[i].getAttribute("id"))}console.log(this.result);let t=this.result.reduce((e,t)=>e===t?t:null);null===t?this.showLost():this.showWin()}showLost(){this.audioMachine.playTrack("audio_melodic_bonus"),console.log("Congratulations! You lost!"),console.log("-----------------------------------------")}showWin(){this.audioMachine.playTrack("audio_coin_win"),console.log("Congratulations! You win! nothing!"),console.log("-----------------------------------------")}};
//# sourceMappingURL=index.cf346a8b.js.map
